<!DOCTYPE html>
<html>
<head>
    <title>Enhanced Fintel.io Data Extraction Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; background: #f5f5f5; border-radius: 5px; }
        .data-field { margin: 10px 0; }
        .label { font-weight: bold; }
        .value { color: #0066cc; }
        table { border-collapse: collapse; width: 100%; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .log { background: #333; color: #fff; padding: 10px; border-radius: 5px; margin: 10px 0; height: 200px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>Enhanced Fintel.io Data Extraction Test</h1>
    <p><strong>Instructions:</strong></p>
    <ol>
        <li>Load the extension in Chrome</li>
        <li>Navigate to a fintel.io page like: https://fintel.io/ss/us/OPAD</li>
        <li>Open browser console to see extraction logs</li>
        <li>Check Chrome extension storage to see extracted data</li>
    </ol>

    <div class="test-section">
        <h2>Sample Data for Testing Extraction Patterns</h2>
        
        <div class="data-field">
            <span class="label">Short Interest:</span> <span class="value">12.34%</span>
        </div>
        
        <div class="data-field">
            <span class="label">Short Interest Ratio:</span> <span class="value">2.5 days</span>
        </div>
        
        <div class="data-field">
            <span class="label">Short Interest % Float:</span> <span class="value">15.67%</span>
        </div>
        
        <div class="data-field">
            <span class="label">Cost to Borrow:</span> <span class="value">8.25%</span>
        </div>
        
        <div class="data-field">
            <span class="label">FINRA Exempt Volume:</span> <span class="value">1.2M</span>
        </div>
        
        <div class="data-field">
            <span class="label">Last Update:</span> <span class="value">2024-03-15 16:00:00 EST</span>
        </div>
    </div>

    <div class="test-section">
        <h2>Sample Tables for Extraction Testing</h2>
        
        <h3>Short Shares Availability Table</h3>
        <table id="short-shares-availability-table">
            <tr>
                <th>Date</th>
                <th>Shares Available</th>
                <th>Fee Rate</th>
            </tr>
            <tr>
                <td>2024-03-15</td>
                <td>150,000</td>
                <td>5.25%</td>
            </tr>
            <tr>
                <td>2024-03-14</td>
                <td>125,000</td>
                <td>6.75%</td>
            </tr>
        </table>

        <h3>Short Borrow Rate Table</h3>
        <table id="table-short-borrow-rate">
            <tr>
                <th>Date</th>
                <th>Borrow Rate</th>
                <th>Available Shares</th>
            </tr>
            <tr>
                <td>2024-03-15</td>
                <td>8.25%</td>
                <td>150K</td>
            </tr>
            <tr>
                <td>2024-03-14</td>
                <td>9.50%</td>
                <td>125K</td>
            </tr>
        </table>

        <h3>Fails to Deliver Table</h3>
        <table id="fails-to-deliver-table">
            <tr>
                <th>Settlement Date</th>
                <th>FTD Quantity</th>
                <th>Price</th>
            </tr>
            <tr>
                <td>2024-03-15</td>
                <td>50,000</td>
                <td>$12.50</td>
            </tr>
            <tr>
                <td>2024-03-14</td>
                <td>45,000</td>
                <td>$12.25</td>
            </tr>
        </table>
    </div>

    <div class="test-section">
        <h2>Test Console</h2>
        <div id="log" class="log"></div>
        <button onclick="testExtraction()">Test Data Extraction</button>
        <button onclick="clearLog()">Clear Log</button>
    </div>

    <script>
        function log(message) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        function testExtraction() {
            log('🔍 Testing enhanced fintel.io data extraction...');
            
            // Simulate what the content script would do
            const pageText = document.body.textContent;
            log(`📄 Page text length: ${pageText.length} characters`);
            
            // Test pattern matching
            const testPatterns = [
                { name: 'Short Interest', pattern: /Short\s+Interest[:\s]*([0-9.,]+%)/i },
                { name: 'Short Interest Ratio', pattern: /Short\s+Interest\s+Ratio[:\s]*([0-9.,]+\s*days?)/i },
                { name: 'Short Interest % Float', pattern: /Short\s+Interest\s+%\s+Float[:\s]*([0-9.,]+%?)/i },
                { name: 'Cost to Borrow', pattern: /Cost\s+to\s+Borrow[:\s]*([0-9.,]+%)/i },
                { name: 'FINRA Exempt Volume', pattern: /FINRA\s+Exempt\s+Volume[:\s]*([0-9.,]+[KMB]?)/i },
                { name: 'Last Update', pattern: /Last\s+Update[:\s]*([^.\n]+)/i }
            ];

            testPatterns.forEach(({ name, pattern }) => {
                const match = pageText.match(pattern);
                if (match) {
                    log(`✅ Found ${name}: ${match[1]}`);
                } else {
                    log(`❌ Pattern not found for ${name}`);
                }
            });

            // Test table extraction
            const tables = ['short-shares-availability-table', 'table-short-borrow-rate', 'fails-to-deliver-table'];
            tables.forEach(tableId => {
                const table = document.getElementById(tableId);
                if (table) {
                    const rows = table.querySelectorAll('tr');
                    log(`📊 Table ${tableId}: ${rows.length} rows found`);
                } else {
                    log(`❌ Table ${tableId} not found`);
                }
            });

            log('✅ Test completed - check browser console for extension logs');
        }

        // Auto-run test when page loads
        window.addEventListener('load', () => {
            setTimeout(() => {
                log('🚀 Page loaded, ready for testing');
                testExtraction();
            }, 1000);
        });
    </script>
</body>
</html>