<!DOCTYPE html>
<html>
<head>
    <title>Debug DilutionTracker Issue</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .debug-section { margin: 20px 0; padding: 15px; background: #f5f5f5; border-radius: 5px; border-left: 4px solid #ff9800; }
        .code { background: #1e1e1e; color: #fff; padding: 15px; border-radius: 5px; font-family: monospace; white-space: pre-wrap; }
        .url-test { margin: 10px 0; padding: 10px; background: white; border-radius: 3px; }
        .issue { background: #ffebee; border-left: 4px solid #f44336; padding: 15px; margin: 15px 0; }
    </style>
</head>
<body>
    <h1>🐛 Debug DilutionTracker Color Highlighting Issue</h1>
    
    <div class="issue">
        <h3>❌ Problem Report</h3>
        <p><strong>Issue:</strong> None of the dilutiontracker.com URLs are triggering color changes</p>
        <p><strong>Expected:</strong> Green highlighting should appear on matching data fields</p>
        <p><strong>Actual:</strong> No color changes occurring</p>
    </div>

    <div class="debug-section">
        <h3>🔍 Step 1: Test URL Pattern Matching</h3>
        <button onclick="testUrlPatterns()">Test Current URL Patterns</button>
        <div id="url-test-results"></div>
    </div>

    <div class="debug-section">
        <h3>🔍 Step 2: Check Console Output</h3>
        <p>When visiting a DilutionTracker page, you should see:</p>
        <div class="code">🔍 DilutionTracker content script loaded
🔍 DilutionTracker: Checking URL: https://dilutiontracker.com/app/search/OPAD
📊 Detected ticker page: OPAD (from URL: https://dilutiontracker.com/app/search/OPAD)
🔍 Extracting data for OPAD...</div>
        <p><strong>If you don't see these messages, the URL matching is broken.</strong></p>
    </div>

    <div class="debug-section">
        <h3>🔍 Step 3: Manual Pattern Test</h3>
        <p>Test the regex pattern manually:</p>
        <button onclick="manualPatternTest()">Run Manual Test</button>
        <div id="manual-test-results"></div>
    </div>

    <div class="debug-section">
        <h3>🔧 Potential Issues to Check</h3>
        <ol>
            <li><strong>Content Script Loading:</strong> Is the script injecting into DilutionTracker pages?</li>
            <li><strong>URL Pattern:</strong> Is the regex pattern correctly matching URLs?</li>
            <li><strong>Data Extraction:</strong> Is the extractTickerData function finding the data?</li>
            <li><strong>Color Highlighting:</strong> Are the highlighting functions being called?</li>
            <li><strong>DOM Elements:</strong> Are the target elements present on the page?</li>
        </ol>
    </div>

    <script>
        function testUrlPatterns() {
            const resultsDiv = document.getElementById('url-test-results');
            resultsDiv.innerHTML = '<h4>Testing URL Pattern Matching...</h4>';

            // The current pattern from the updated code
            const pattern = /\/app\/search\/([A-Z]{1,5})(?:[/?#]|$)/i;
            
            const testUrls = [
                'https://dilutiontracker.com/app/search/OPAD',
                'https://dilutiontracker.com/app/search/OPAD?a=',
                'https://dilutiontracker.com/app/search/TSLA?a=123',
                'https://dilutiontracker.com/app/search/AMC/',
                'https://dilutiontracker.com/app/search/GME#section',
                'https://dilutiontracker.com/', // Should not match
                'https://dilutiontracker.com/app/search/', // Should not match
            ];

            testUrls.forEach(url => {
                const match = url.match(pattern);
                const ticker = match ? match[1] : null;
                
                const testDiv = document.createElement('div');
                testDiv.className = 'url-test';
                testDiv.style.borderLeft = ticker ? '4px solid #4caf50' : '4px solid #f44336';
                testDiv.innerHTML = `
                    <strong>URL:</strong> ${url}<br>
                    <strong>Match:</strong> ${ticker ? `✅ ${ticker}` : '❌ No match'}
                `;
                resultsDiv.appendChild(testDiv);
            });
        }

        function manualPatternTest() {
            const resultsDiv = document.getElementById('manual-test-results');
            
            // Simulate what the content script does
            const testUrl = 'https://dilutiontracker.com/app/search/OPAD?a=';
            const pattern = /\/app\/search\/([A-Z]{1,5})(?:[/?#]|$)/i;
            
            console.log('🔍 Manual test: Checking URL:', testUrl);
            const match = testUrl.match(pattern);
            
            if (match) {
                const ticker = match[1].toUpperCase();
                console.log('📊 Manual test: Detected ticker:', ticker);
                
                resultsDiv.innerHTML = `
                    <div style="background: #e8f5e8; padding: 10px; border-radius: 3px;">
                        ✅ <strong>Pattern Match Successful!</strong><br>
                        URL: <code>${testUrl}</code><br>
                        Ticker: <strong>${ticker}</strong><br>
                        <em>The URL pattern matching is working correctly.</em>
                    </div>
                `;
            } else {
                console.log('❌ Manual test: No match found');
                resultsDiv.innerHTML = `
                    <div style="background: #ffebee; padding: 10px; border-radius: 3px;">
                        ❌ <strong>Pattern Match Failed!</strong><br>
                        URL: <code>${testUrl}</code><br>
                        <em>The URL pattern is not working. This is the root cause.</em>
                    </div>
                `;
            }
        }

        // Auto-run tests
        window.addEventListener('load', () => {
            setTimeout(() => {
                testUrlPatterns();
                manualPatternTest();
            }, 500);
        });

        // Also test the actual content script logic
        function testContentScriptLogic() {
            console.log('🧪 Testing content script logic...');
            
            // Simulate the checkAndHandleTickerPage function
            function checkAndHandleTickerPage() {
                const currentUrl = 'https://dilutiontracker.com/app/search/OPAD?a='; // Test URL
                console.log(`🔍 DilutionTracker: Checking URL: ${currentUrl}`);
                
                const tickerMatch = currentUrl.match(/\/app\/search\/([A-Z]{1,5})(?:[/?#]|$)/i);

                if (tickerMatch) {
                    const ticker = tickerMatch[1].toUpperCase();
                    console.log(`📊 Detected ticker page: ${ticker} (from URL: ${currentUrl})`);
                    return ticker;
                } else {
                    console.log(`🔍 Not a ticker page: ${currentUrl}`);
                    return null;
                }
            }
            
            const result = checkAndHandleTickerPage();
            console.log('🧪 Content script simulation result:', result);
        }

        // Run the content script simulation
        testContentScriptLogic();
    </script>
</body>
</html>